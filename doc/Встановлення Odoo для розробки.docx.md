# **Встановлення Odoo для розробки.**

## ***Сценарій***

1. Попередні вимоги  
2. Встановлення odoo-helper-scripts  
3. Встановлення odoo  
4. Методи управління сервером Odoo  
5. Методи управління базами даних  
6. Методи управління репозиторіями та аддонами

## ***Попередні вимоги***

Для успішного проходження даного уроку, має бути локально встановлена операційна система Ubuntu 22.04 або похідна від неї. Якщо у вас інший дистрибутив linux, то можуть бути необхідні додаткові дії, хоча дистрибутиви що базуються на debian мають працювати добре. Також потрібні базові навички роботи з терміналом (інтерфейсом командного рядка (CLI)). 

## ***Встановлення odoo-helper-scripts***

odoo-helper-scripts \- це набір утиліт для управління локальними установками odoo. Цей набір утиліт дає можливість одночасно працювати з багатьма версіями odoo локально, та помітно знижує кількість залежностей які потрібно встановлювати в систему за рахунок використання віртуальних оточень python (virtualenv). Такий підхід також дозволяє уникнути конфліктів залежностей при роботі одночасно з багатьма різними версіями odoo.

Документація по проекту odoo-helper-scripts доступна за посиланням: [https://katyukha.gitlab.io/odoo-helper-scripts/](https://katyukha.gitlab.io/odoo-helper-scripts/)

Отже для встановлення odoo-helper-scripts в системі глобально потрібно виконати наступні команди (краще виконувати по черзі):

\# Встановити базові залежності  
sudo apt install wget git;  
sudo apt install nodejs npm;

\# Завантажити скріпт встановлення  
wget \-O /tmp/odoo-helper-install.bash https://gitlab.com/katyukha/odoo-helper-scripts/raw/master/install-system.bash;

\# Встановити odoo-helper-scripts  
sudo bash /tmp/odoo-helper-install.bash;

\# Встановити базові залежності для odoo-helper-scripts  
odoo-helper install pre-requirements;

Для того щоб перевірити встановлення odoo-helper-scripts можна виконати команду:

odoo-helper version

Далі необхідно встановити систему управління базами даних PostgreSQL. Для цього потрібно виконати команду:

odoo-helper install postgres

Після завершення цих операцій odoo-helper-scripts встановлені і готові до роботи. Далі можна переходити до встановлення Odoo

## ***Встановлення Odoo***

В даному курсі ми будемо встановлювати Odoo версії 17.0. 

Для початку нам потрібно встановити системні залежності необхідні для функціонування даної версії Odoo. Для цього нам потрібно виконати наступну команду:

odoo-helper install sys-deps 17.0

Далі, для встановлення оду ми можемо використати команду odoo-install.  
Щоб отримати доступні опції для даної команди, можна виконати її з опцією \--help.

odoo-install \--help

Із цікавих для нас опцій можна виділити наступні:

\-i|--install-dir \<dir\>        \- directory to install odoo in.

\--odoo-version \<odoo version\> \- odoo version to install. default: 12.0

\--dev                         \- \[sudo\] This option enables automatic installation of developer tools, like, pylint, flake8, unbuffer, etc. May require sudo.

\--create-db-user              \- \[sudo\] if set, odoo-helper will try to create postgresql user after the installation of odoo.

\--db-user \<user\>              \- database user to be used in settings. default: odoo  
\--http-port \<port\>            \- automatically set configuration for http port for this instance

Отже, розберемо детально:

- \-i|--install-dir \<dir\> \- Ця опція потрібна щоб вказати шлях дуки встановити Odoo   
- \--odoo-version \<odoo version\> \- Ця опція дозволяє вибрати версію Odoo для встановлення  
- \--dev \- Ця опція дозволяє відразу встановити додаткові інструменти розробника одразу після встановлення Odoo  
- \--create-db-user \- Ця опція автоматично створить нового користувача бази даних.  
- \--db-user \- Ця опція дозволяє вказати назву користувача бази даних якого використовувати для підключення до бази даних. Зазвичай краще для кожної установки оду створювати свого користувача бази даних для уникнення ситуацій коли кілька встановлених оду намагаються працювати з однією і тією ж базою даних.  
- \--http-port \- Ця команда дозволяє одразу вказати на якому порту запускати встановлену версію Odoo. Зазвичай, коли працюєш з багатьма версіями Odoo то краще кожну версію піднімати на окремому порту. В даному випадку вона потрібна нам щоб запустити Odoo на порту 15069 замість стандартного для Odoo порту 8069\.


  
В результаті, команда для встановлення оду матиме наступний вигляд:

odoo-install \--install-dir ./odoo-17.0 \--odoo-version 17.0 \--dev \--db-user odoo17 \--create-db-user \--http-port 15069

Після встановлення буде створена директорія odoo-17.0 із наступною структурою:

- backups \- директорія для бекапів виконаних командою odoo-helper db backup  
- bin \- поки не використовується  
- conf  
  - odoo.conf \- конфігураційний файл odoo  
  - odoo.test.conf \- конфігураційний файл odoo (для авто тестів)  
- custom\_addons \- директорія для сторонніх аддонів. Зазвичай автоматично поповнюється символьними посиланнями на аддони розміщені в репозиториях.  
- data \- директорія де odoo зберігає свої дані  
- downloads \- директорія для завантажень. Зокрема сюди завантажуються застосунки, завантажені з Odoo Apps командою odoo-helper fetch  
- libs \- поки не використовується  
- logs \- директорія для зберігання лог файлів  
- odoo \- встановлена версія Odoo   
- odoo-helper.conf \- конфігураційний файл odoo-helper-scripts  
- repositories \- директорія для репозитаріїв. Зазвичай наповнюється автоматично командою odoo-helper fetch  
- venv \- директорія для віртуального оточення, яке використовується даною установкою

Отже odoo тепер встановлене і готове до роботи.

## ***Методи управління сервером Odoo***

Зверніть увагу, що всі команди що стосуються конкретної установки оду (включаючи управління сервером та управління базами даних) мають запускатись з робочої директорії що знаходиться всередині установки Odoo (в нашому випадку це odoo-17.0 та будь яка з її під-директорій).

Доступні наступні команди управління сервером Odoo:

- odoo-helper start \- запустити сервер  
- odoo-helper stop \- зупинити сервер  
- odoo-helper restart \- перезапустити сервер  
- odoo-helper log \- переглянути логи сервера. Дана команда відкриває лог файл за допомогою програми less. Для більш зручної роботи з логами рекомендуємо ознайомитись з документацією по даній команді (зокрема https://gist.github.com/glnds/8862214)  
- odoo-helper ps \- показати список запущених процесів  
- odoo-helper browse \- відкрити Odoo в браузері

Отже, для того щоб запустити сервер і переглянути Odoo в браузері, нам досить виконати наступну команду:

odoo-helper browse

Ця команда запустить сервер (якщо він був не запущений) та відкриє Odoo в браузері.

Також дані команди доступні як під-команди odoo-helper server. Для того щоб подивитись всі доступні команди управління сервером, можна виконати команду:

odoo-helper server \--help

## ***Методи управління базами даних Odoo***

odoo-helper-scripts також надає додаткові можливості управління базами даних встановленої версії Odoo.

**Важливо**, не потрібно використовувати веб\-інтерфейс Odoo для управління базами даних. Так як, при будь-яких операціях з базами даних через веб інтерфейс, odoo перепише конфігураційний файл (conf/odoo.conf) так, замінить параметр admin\_passwd на хеш пароля, що унеможливлює використання консольного інтерфейсу для управління базами. Якщо ж це сталось, то потрібно вручну відредагувати конфігураційний файл Odoo (conf/odoo.conf) і прописати нове значення параметра admin\_passwd. Оскільки на даному етапі ми розбираємо розгортання середовища для розробки, то значення цього параметра не важливе. Встановлення odoo для production та управління базами в production оточенні відрізняється.

За управління базами даних відповідає команда *odoo-helper db*. Для того щоб побачити всі доступні команди управління базами даних, потрібно викликати наступну команду:

odoo-helper db \--help  
Ця команда виведе всі доступні команди управління базами даних.

Далі, розглянемо основні команди, які використовуються найчастіше під час розробки:

- odoo-helper db list \- переглянути список баз даних доступних для інстанції Odoo  
- odoo-helper db create \- створити нову базу даних  
- odoo-helper db drop \- видалити базу даних  
- odoo-helper db backup \- створити резервну копію вказаної бази даних  
- odoo-helper db restore \- відновити базу даних із резервної копії

Кожна з цих команд підтримує опцію \--help, що виведе інформацію про доступн параметри та опції команди.

Отже для створення нашої тестової бази даних, ми можемо виконати наступну команду:

odoo-helper db create \--demo \--tdb \--install crm

Дана команда створить нову тестову базу (з назвою *odoo17-odoo-test*) та відразу після створення установить модуль CRM, що входить в стандартну комплектацію Odoo.

## ***Методи управління репозиторіями та аддонами***

Одна із найбільш часто використовуваних операцій в Odoo- це установка сторонніх модулів в систему. фактично, ця операція складається з двох частин: встановлення (доставка) аддона на сервер, та встановлення аддона в базу даних. Останній крок, зазвичай виконується через веб\-інтерфейс Odoo.

Один із найпростіших способів встановити сторонній аддон в Odoo, це просто скопіювати його в одну із директорій що входить в список директорій в яких оду шукає додатки (у випадку установок на базі odoo-helper такою директорією є custom\_addons), але такий підхід призводить до наступних складнощів у подальшій підтримці:

- При оновленні аддонів шляхом копіювання є досить великий шанс забути видалити стару версію аддону перед копіюванням нової, що залишає купу сміття.  
- При оперуванні досить великими групами аддонів (100+ на сервер) досить складно керувати версіями і сумісністю версій аддонів.  
- Потрібно вручну встановлювати залежності для кожного аддона.

За можливості рекомендовано утриматись від такого способу управління аддонами та розглянути інші варіанти.

Невелика примітка стосовно філософії odoo-helper-scripts: директорія custom\_addons має лише зберігати символьні посилання на додатки, які можуть бути розміщені в інших директоріях.

Щоб краще зрозуміти які інструменти необхідні для управління сторонніми додатками в Odoo, розглянемо способи дистрибуції сторонніх додатків.  
Отже, сторонні додатки оду зазвичай розповсюджуються наступними методами:

- Публікуються на Odoo Apps ([https://apps.odoo.com/apps](https://apps.odoo.com/apps))  
- Публікуються у вигляді git репозиторію. (зазвичай це стосується вільних додатків (наприклад додатків OCA ([https://github.com/OCA](https://github.com/OCA))), хоча це також стосується і платних додатків, так як розробникам зручніше надати доступ до git-репозиторію, ніж займатись копіюванням файлів.  
- Також, додатки можуть розповсюджуватись у вигляді python-пакетів. Зокрема, такий підхід використовує OCA ([https://pypi.org/user/OCA/](https://pypi.org/user/OCA/)) та MuK IT ([https://nexus.mukit.at/\#browse/browse:odoo](https://nexus.mukit.at/#browse/browse:odoo))

Отже почнемо розбирати кожен із варіантів.

Стосовно додатків завантажених (або куплених) з Odoo Apps, то рекомендованим способом роботи з ними є створення для них окремого репозиторія або репозиторіїв. Це як мінімум дасть можливість контролю змін при оновленні, та можливість відкату на попередню версію (деякі пакети модулів з Odoo Apps можуть включати більше 100 додатків). І далі, працювати з ними таким же чином як і з додатками опублікованими у вигляді git-репозиторію.

У тих випадках, коли винесення таких додатків в окремий репозиторій є не актуальним, то такі додатки має сенс складати в окрему директорію і робити символьні посилання на ці додатки в директорії custom\_addons.  
Для цього можна використовувати команду odoo-helper link:

odoo-helper link \<addon path\>

Де \<addon path\> \- це шлях до аддона, або шлях до директорії з аддонами. Ця команда автоматично знайде всі додатки за вказаним шляхом і створить для них символьні посилання в директорії custom\_addons. Якщо додати які потрібно додати на сервер поставлені у вигляді архіву з додатками, то перед цією операцією, архів потрібно розпакувати.

Якщо потрібно вистановити один або кілька відкритих (безкоштовних) додатків на Odoo Apps, то odoo-helper-scripts надає можливість скачувати такі додатки досить просто наступною командою:

odoo-helper fetch \--odoo-app \<name of odoo app\>

Ця команда, автоматично завантажить відповідний додаток (правильну версію)  і зробить всі необхідні символьні посилання.

Наприклад, додамо на сервер додаток [bureaucrat\_helpdesk\_lite](https://apps.odoo.com/apps/modules/15.0/bureaucrat_helpdesk_lite/). Для цього, виконаємо наступну команду:

odoo-helper fetch \--odoo-app bureaucrat\_helpdesk\_lite

Після цієї операції, якщо у нас уже є створена база, то нам потрібно виконати команду:

odoo-helper addons update-list

Ця команда, для кожної з баз даних на цій інстанції оду синхронізує інформацію про доступні на сервері додатки. Також цю операцію можна зробити через інтерфейс Odoo

Якщо ж додаток розповсюджується як git-репозиторій, до для його завантаження варто використати команду

odoo-helper fetch \--repo \<git repository\>

Ця команда автоматично завантажить потрібну гілку вказаного репозиторію, знайде там доступні аддони, та створить символьні посилання на них в директорії custom\_addons.

Наприклад завантажимо на сервер набір аддонів що відносяться до управління базою знань [bureaucrat knowledge](https://github.com/crnd-inc/bureaucrat-knowledge):

odoo-helper fetch \--repo [https://github.com/crnd-inc/bureaucrat-knowledge](https://github.com/crnd-inc/bureaucrat-knowledge)

Після цього нам потрібно оновити список аддонів у базах даних, і зможемо встановлювати аддони із цього репозиторію.

Важливо: команди odoo-helper fetch та odoo-helper link автоматично спробують встановити необхідні залежності в систему (python-пакети та репозиторії з адднами від яких залежать вибрані аддони, відповідно попередня команда (що встановлює аддони бази знань) також завантажить гіт репозиторій вказані в залежностях в файлі [odoo\_requirements.txt](https://github.com/crnd-inc/bureaucrat-knowledge/blob/15.0/odoo_requirements.txt).

Також для кращого розуміння доступних команд та опцій, рекомендовано використовувати опцію \--help яка доступна у більшості команд:

- odoo-helper addons \--help  
- odoo-helper fetch \--help  
- odoo-helper link \--help

Використання опції \--help надасть більш повну, а головне актуальну, інформацію про команду та доступні опції

## 

## [***Перевірка модулів за допомогою лінтерів***](#перевірка-модулів-за-допомогою-лінтерів) {#перевірка-модулів-за-допомогою-лінтерів}

Для написання якісного коду використовують певні стандарти. Зазвичай при розробці Odoo модулів за основу обирають стандарти OCA. 

Скрипт odoo-helper має вбудовані команди для перевірки якості коду "лінтерами".

Перед їх використанням потрібно встановити необхідні додаткові утиліти необхідні для розробки. Для цього досить виконати команду:  
odoo-helper install dev-tools

Після цього можна запускати перевірку коду наступним чином:

* Щоб перевірити всі модулі у поточному каталозі лінтером "pylint"  
  odoo-helper lint pylint .

* Щоб перевірити всі модулі у поточному каталозі лінтером "flake8"  
  odoo-helper lint flake8 .

* Щоб перевірити JS код у всіх модулях у поточному каталозі лінтером "stylelint"  
  odoo-helper lint style .

У вищевказаних команд існують псевдоніми, котрі можна також використовувати:

* "odoo-helper lint pylint" \= "**odoo-helper pylint**"  
* "odoo-helper lint flake8" \= "**odoo-helper flake8**"  
* "odoo-helper lint style" \= "**odoo-helper style**"

