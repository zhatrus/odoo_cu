# **Завдання до Модуля 3**

# **Розширений функціонал hr\_hospital**

## **Ціль**

Розширити функціонал модуля "hr\_hospital" з використанням всіх концепцій, вивчених у блоці 3: моделі та наслідування, поля різних типів, методи моделей, рекордсети, домени пошуку та візарди.

## **Дані**

Зміни вносити до модуля, розробленого у блоці 2 "Створення модуля".

## **Вимоги**

### **1\. Абстрактна модель та наслідування**

#### **1.1. Створити абстрактну модель "Особа" (abstract.person)**

**Наслідувати від**: image.mixin **Поля**:

* **ПІБ** (окремі поля: прізвище, ім'я, по батькові)  
* **Телефон** (з валідацією формату)  
* **Email** (з валідацією)  
* **Стать** (Selection: чоловік/жінка/інше)  
* **Дата народження**  
* **Вік** (обчислювальне поле від поточної дати)  
* **Повне ім'я** (обчислювальне поле, що об'єднує ПІБ)  
* **Країна громадянства** (Many2one до res.country)  
* **Мова спілкування** (Many2one до res.lang)

#### **1.2. Успадкувати від абстрактної моделі**

* Модель **Пацієнт**  
* Модель **Лікар**  
* Створити нову модель **Контактна особа** (contact.person)

### **2\. Розширення існуючих моделей**

#### **2.1. Модель "Пацієнт" (додатково до успадкованих полів)**

* **Персональний лікар** (Many2one до моделі Лікар)  
* **Паспортні дані** (Char, size=10)  
* **Контактна особа** (Many2one до моделі Контактна особа)  
* **Група крові** (Selection: O(I), A(II), B(III), AB(IV) з резус-фактором)  
* **Алергії** (Text поле)  
* **Страхова компанія** (Many2one до res.partner з domain на компанії)  
* **Номер страхового поліса** (Char)  
* **Історія персональних лікарів** (One2many)

#### **2.2. Модель "Лікар" (додатково до успадкованих полів)**

* **Користувач системи** (Many2one до res.users, для входу в систему)  
* **Спеціальність** (Many2one до окремої моделі "Спеціальність лікаря")  
* **Інтерн** (Boolean)  
* **Лікар-ментор** (Many2one до моделі Лікар, доступне лише для інтернів)  
* **Ліцензійний номер** (Char, обов'язкове, copy=False)  
* **Дата видачі ліцензії** (Date)  
* **Досвід роботи** (обчислювальне поле від дати видачі ліцензії)  
* **Рейтинг** (Float з digits=(3,2), від 0.00 до 5.00)  
* **Графік роботи** (One2many до моделі "Розклад лікаря")  
* **Країна навчання** (Many2one до res.country)

#### **2.3. Модель "Візити пацієнтів"**

* **Статус візиту** (Selection: заплановано/завершено/скасовано/не з'явився)  
* **Заплановані дата та час** (Datetime)  
* **Фактичні дата та час візиту** (Datetime, readonly якщо статус не "завершено")  
* **Лікар** (Many2one, required=True)  
* **Пацієнт** (Many2one, required=True)  
* **Тип візиту** (Selection: первинний/повторний/профілактичний/невідкладний)  
* **Діагнози** (One2many до моделі "Діагноз")  
* **Рекомендації** (Html поле)  
* **Вартість візиту** (Monetary з currency\_field)  
* **Валюта** (Many2one до res.currency)

### **3\. Нові моделі**

#### **3.1. Модель "Діагноз" (medical.diagnosis)**

* **Візит** (Many2one до моделі "Візити пацієнтів", ondelete='cascade')  
* **Хвороба** (Many2one до моделі "Хвороби")  
* **Опис діагнозу** (Text)  
* **Призначене лікування** (Html)  
* **Затверджено** (Boolean, default=False)  
* **Лікар, що затвердив** (Many2one до моделі Лікар, readonly=True)  
* **Дата затвердження** (Datetime, readonly=True)  
* **Ступінь тяжкості** (Selection: легкий/середній/тяжкий/критичний)

#### **3.2. Модель "Спеціальність лікаря" (doctor.speciality)**

* **Назва** (Char, required=True)  
* **Код спеціальності** (Char, size=10, required=True)  
* **Опис** (Text)  
* **Активна** (Boolean, default=True)  
* **Лікарі** (One2many до моделі Лікар)

#### **3.3. Модель "Розклад лікаря" (doctor.schedule)**

* **Лікар** (Many2one, required=True)  
* **День тижня** (Selection: понеділок-неділя)  
* **Дата** (Date, для конкретних дат)  
* **Час початку** (Float)  
* **Час закінчення** (Float)  
* **Тип** (Selection: робочий\_день/відпустка/лікарняний/конференція)  
* **Примітки** (Char)

#### **3.4. Модель "Історія персональних лікарів" (patient.doctor.history)**

* **Пацієнт** (Many2one, required=True)  
* **Лікар** (Many2one, required=True)  
* **Дата призначення** (Date, required=True, default=today)  
* **Дата зміни** (Date)  
* **Причина зміни** (Text)  
* **Активний** (Boolean, default=True)

### **4\. Розширення модель "Хвороби" \- ієрархічна структура**

* **Батьківська хвороба** (Many2one до себе)  
* **Дочірні хвороби** (One2many до себе)  
* **Код МКХ-10** (Char, size=10)  
* **Ступінь небезпеки** (Selection: низький/середній/високий/критичний)  
* **Заразна** (Boolean)  
* **Симптоми** (Text)  
* **Регіон поширення** (Many2many до res.country)

### **5\. Обмеження та валідація**

#### **5.1. SQL обмеження**

* Унікальність ліцензійного номера лікаря  
* Перевірка рейтингу лікаря (0.00 \<= рейтинг \<= 5.00)  
* Час закінчення \> час початку в розкладі лікаря

#### **5.2. Python обмеження (@api.constrains)**

* Заборона вибору інтерна як лікаря-ментора  
* Заборона запису одного пацієнта до одного лікаря більше одного разу на день  
* Перевірка що лікар не може бути ментором самому собі  
* Дата проведення дослідження не може бути раніше дати призначення  
* Вік пацієнта має бути більше 0

#### **5.3. Обмеження на видалення та архівування**

* Заборона видалення візитів з діагнозами  
* Заборона архівування лікарів, що мають активні візити  
* Заборона зміни лікаря/дати/часу візиту, що вже відбувся

### **6\. Методи та бізнес логіка**

#### **6.1. Автоматичні дії**

* При зміні персонального лікаря пацієнта \- автоматично створювати запис в історії  
* При затвердженні діагнозу ментором \- оновлювати поле "Затверджено" та дати

#### **6.2. Обчислювальні поля з залежностями (@api.depends)**

* Вік особи від дати народження  
* Досвід роботи лікаря від дати видачі ліцензії  
* Повне ім'я від окремих полів ПІБ  
* Кількість діагнозів на візиті

#### **6.3. Методи onchange (@api.onchange)**

* При виборі пацієнта \- показувати попередження про алергії  
* При виборі лікаря-інтерна \- автоматично заповнювати ментора  
* При зміні країни громадянства пацієнта \- пропонувати відповідну мову спілкування

#### **6.4. Перевизначення стандартних методів**

* **create** для моделі "Історія персональних лікарів" \- встановлювати попередній запис як неактивний  
* **write** для моделі "Пацієнт" \- при зміні персонального лікаря створювати історію  
* **name\_get** для моделі "Лікар" \- відображати "Ім'я (Спеціальність)"  
* **unlink** для моделі "Візити" \- перевіряти наявність діагнозів

### **7\. Візарди (TransientModel)**

#### **7.1. Візард масового перепризначення лікаря**

**Модель**: mass.reassign.doctor.wizard **Поля**:

* **Старий лікар** (Many2one до моделі Лікар)  
* **Новий лікар** (Many2one до моделі Лікар, required=True)  
* **Пацієнти** (Many2many до моделі Пацієнт, domain на пацієнтів старого лікаря)  
* **Дата зміни** (Date, default=today)  
* **Причина зміни** (Text, required=True)

**Виклик**: з перегляду "list" моделі "Пацієнт" через меню "Дія"

#### **7.2. Візард звіту по хворобах за період**

**Модель**: disease.report.wizard **Поля**:

* **Лікарі** (Many2many до моделі Лікар, якщо порожнє \- по всім лікарям)  
* **Хвороби** (Many2many до моделі Хвороби, якщо порожнє \- по всім хворобам)  
* **Країни** (Many2many до res.country, фільтр за країною громадянства пацієнтів)  
* **Дата початку** (Date, required=True)  
* **Дата закінчення** (Date, required=True)  
* **Тип звіту** (Selection: детальний/підсумковий)  
* **Групувати за** (Selection: лікарем/хворобою/місяцем/країною)

**Результат**: метод, що повертає список діагнозів за критеріями

#### **7.3. Візард перенесення візиту**

**Модель**: reschedule.visit.wizard  
 **Поля**:

* **Поточний візит** (Many2one до моделі "Візити", readonly=True)  
* **Новий лікар** (Many2one до моделі Лікар)  
* **Нова дата** (Date, required=True)  
* **Новий час** (Float, required=True)  
* **Причина перенесення** (Text, required=True)

**Функціонал**: звільняє старий слот та створює новий запис візиту

#### **7.4. Візард заповнення розкладу лікаря**

**Модель**: doctor.schedule.wizard **Поля**:

* **Лікар** (Many2one, required=True)  
* **Тиждень початку** (Date, required=True)  
* **Кількість тижнів** (Integer, default=1, required=True)  
* **Тип розкладу** (Selection: стандартний/парний\_тиждень/непарний\_тиждень)  
* **Понеділок-Неділя** (Boolean поля для кожного дня)  
* **Час початку** (Float)  
* **Час закінчення** (Float)  
* **Перерва з** (Float)  
* **Перерва до** (Float)

#### **7.4. Візард експорту медичної картки пацієнта**

**Модель**: patient.card.export.wizard **Поля**:

* **Пацієнт** (Many2one, required=True)  
* **Дата початку** (Date)  
* **Дата закінчення** (Date)  
* **Включити діагнози** (Boolean, default=True)  
* **Включити рекомендації** (Boolean, default=True)  
* **Мова звіту** (Many2one до res.lang, default=мова пацієнта)  
* **Формат експорту** (Selection: JSON/CSV)

### **8\. Домени та фільтрація**

#### **8.1. Складні домени**

* При заповненні моделі візиту за допомогою домену заборонити призначати лікаря без заповненого поля "ліцензійний номер"  
* При створенні контактної особи за допомогою домену показувати тільки пацієнтів з заповненим полем "алергії"  
* При створенні діагнозу за допомогою домену показувати тільки завершені візити за останні 30 днів  
* При призначенні ментора за допомогою домену показувати тільки лікарів, які НЕ є інтернами  
* При створенні діагнозу за допомогою домену показувати тільки заразні хвороби з високим або критичним ступенем небезпеки  
* При створенні розкладу лікаря за допомогою домену показувати тільки лікарів з заповненою спеціальністю

#### **8.2. Динамічні домени через методи**

* Доступні лікарі для запису (за спеціальністю та розкладом)  
* Можливі дати візитів (виключаючи вихідні та відпустки лікаря)  
* Лікарі за країною навчання  
* Пацієнти за мовою спілкування та країною громадянства

### **9\. Демо дані**

Створити демо дані для:

* 5 спеціальностей лікарів  
* 8 лікарів (включаючи 2 інтернів з менторами) з прив'язкою до користувачів системи  
* 15 пацієнтів з контактними особами  
* 12 хвороб з ієрархією (2-3 рівні) з регіонами поширення  
* 25 візитів з різними статусами  
* 20 діагнозів (включаючи незатверджені від інтернів)  
* Розклад для всіх лікарів на поточний тиждень  
* Історію призначення персональних лікарів

## **Критерії оцінювання**

1. **Повнота виконання** (45%) \- реалізація всіх вимог завдання  
2. **Якість коду** (30%) \- дотримання стандартів Odoo, структура файлів  
3. **Функціональність** (20%) \- коректна робота всіх методів та обмежень  
4. **Демо дані** (5%) \- повнота та реалістичність тестових даних

## **Результат**

Завантажити модуль у відкритий репозиторій на GitHub з детальним README файлом, що описує функціонал та інструкції по встановленню.

